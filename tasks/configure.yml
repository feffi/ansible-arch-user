---
- name: Create user group
  group:
    name: "{{ ansible_user.group }}"
    state: present
  tags:
    - user

- name: Create user and assign to group
  user:
    name: "{{ ansible_user.name }}"
    group: "{{ ansible_user.group }}"
    password: "{{ ansible_user.password|password_hash('sha512') }}"
    shell: "{{ ansible_user.shell }}"
    update_password: on_create
    groups: "{{ ansible_user.groups }}"
    append: yes
  tags:
    - user
